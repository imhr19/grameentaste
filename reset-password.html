<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reset Password | Grameen Taste</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fffaf0; /* Light green */
    }
    .brand-btn {
      background-color: #16a34a;
    }
    .brand-btn:hover {
      background-color: #15803d;
    }
    .brand-title {
      color: #065f46;
    }
    .input-group {
      position: relative;
    }
    .toggle-eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #6b7280;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen px-4">
  <div class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-center brand-title">Reset Your Password</h2>

    <div class="input-group mb-3">
      <input
        type="password"
        id="new-password"
        placeholder="New Password"
        class="w-full p-2 border border-gray-300 rounded"
      />
      <span class="toggle-eye" onclick="toggleVisibility('new-password', this)">👁️</span>
    </div>

    <div class="input-group mb-4">
      <input
        type="password"
        id="confirm-password"
        placeholder="Confirm New Password"
        class="w-full p-2 border border-gray-300 rounded"
      />
      <span class="toggle-eye" onclick="toggleVisibility('confirm-password', this)">👁️</span>
    </div>

    <button
      id="reset-btn"
      class="w-full text-white py-2 rounded brand-btn text-lg"
    >
      Update Password
    </button>

    <p id="reset-message" class="mt-4 text-sm text-center hidden p-2 rounded"></p>
  </div>

  <!-- Firebase + JS Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBCj71-HO8i_xpgQ-Wbn5j85V9yHeJKdOg", // 🔁 Replace with your actual API key
      authDomain: "grameentaste-929dc.firebaseapp.com",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const urlParams = new URLSearchParams(window.location.search);
    const oobCode = urlParams.get('oobCode');

    const newPasswordInput = document.getElementById("new-password");
    const confirmPasswordInput = document.getElementById("confirm-password");
    const resetBtn = document.getElementById("reset-btn");
    const msgBox = document.getElementById("reset-message");

    function showMessage(msg, type) {
      msgBox.textContent = msg;
      msgBox.classList.remove("hidden");
      msgBox.className =
        "mt-4 text-sm text-center p-2 rounded " +
        (type === "success" ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800");
    }

    function validatePassword(password) {
      const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[#@$!%*?&^_])[A-Za-z\d#@$!%*?&^_]{8,18}$/;
      return regex.test(password);
    }

    resetBtn.addEventListener("click", () => {
      const password = newPasswordInput.value;
      const confirmPassword = confirmPasswordInput.value;

      if (!password || !confirmPassword) {
        showMessage("Please fill both password fields.", "error");
        return;
      }

      if (password !== confirmPassword) {
        showMessage("Passwords do not match.", "error");
        return;
      }

      if (!validatePassword(password)) {
        showMessage("Password must be 8–18 characters and include uppercase, lowercase, number & special character.", "error");
        return;
      }

      confirmPasswordReset(auth, oobCode, password)
        .then(() => {
          showMessage("Password reset successful! Redirecting...", "success");
          setTimeout(() => {
            window.location.href = "https://grameentaste.infinityfreeapp.com";
          }, 3000);
        })
        .catch((error) => {
          showMessage("Error: " + error.message, "error");
        });
    });
  </script>

  <!-- Eye Toggle Logic -->
  <script>
    function toggleVisibility(fieldId, toggleIcon) {
      const input = document.getElementById(fieldId);
      const isPassword = input.type === "password";
      input.type = isPassword ? "text" : "password";
      toggleIcon.textContent = isPassword ? "🙈" : "👁️";
    }
  </script>
</body>
</html>

