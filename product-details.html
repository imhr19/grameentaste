<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Grameen Taste</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      :root {
        --primary: #6B8E23;
      }
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #F5F5DC;
      }
      /* New Image Magnifier Styles */
      .image-gallery-container {
        position: relative;
      }
      .magnified-result {
        position: absolute;
        top: 0;
        left: 105%;
        width: 100%;
        height: 100%;
        border: 1px solid #ddd;
        background-repeat: no-repeat;
        z-index: 20;
        pointer-events: none;
        display: none; /* Hidden by default */
        background-color: white;
      }
      .main-image-container:hover .magnified-result {
        display: block;
      }
      .thumbnail-list img.active-thumbnail {
        border: 2px solid var(--primary);
        box-shadow: 0 0 8px rgba(107, 142, 35, 0.7);
        transform: scale(1.05);
      }
      /* Horizontal scroll for related products */
      .scroll-container {
        scrollbar-width: thin;
        scrollbar-color: var(--primary) #e0e0e0;
      }
      .scroll-container::-webkit-scrollbar { height: 8px; }
      .scroll-container::-webkit-scrollbar-track { background: #e0e0e0; border-radius: 10px; }
      .scroll-container::-webkit-scrollbar-thumb { background-color: var(--primary); border-radius: 10px; border: 2px solid #e0e0e0; }
      .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
      
      @media (max-width: 1023px) {
        .magnified-result {
            display: none !important; /* Disable magnifier on smaller screens */
        }
      }
    </style>
    <script type="module">
  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup, RecaptchaVerifier, signInWithPhoneNumber, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyBCj71-HO8i_xpgQ-Wbn5j85V9yHeJKdOg",
      authDomain: "grameentaste-929dc.firebaseapp.com",
      projectId: "grameentaste-929dc",
      storageBucket: "grameentaste-929dc.firebasestorage.app",
      messagingSenderId: "472094939233",
      appId: "1:472094939233:web:a5e8f2877e8b9318c83220",
      measurementId: "G-WLHK4FD1D5"
    };
  
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    window.auth = auth;
  
    document.addEventListener('DOMContentLoaded', () => {
        const loginDrawer = document.getElementById("login-drawer");
        const loginOverlay = document.getElementById("login-overlay");
        const loginOpenBtn = document.getElementById("user-btn");
        const loginCloseBtn = document.getElementById("close-login-drawer");
        const profileDrawer = document.getElementById("profileDrawer");
        const closeProfileDrawerBtn = document.getElementById("closeProfileDrawerBtn");
        
        window.showLoginView = function() { /* Logic to show login form */ };
        
        function openProfileDrawer() {
            if(profileDrawer) profileDrawer.classList.remove("translate-x-full");
            if(loginOverlay) loginOverlay.classList.remove("hidden");
        }
        function closeProfileDrawer() {
            if(profileDrawer) profileDrawer.classList.add("translate-x-full");
            if(loginOverlay) loginOverlay.classList.add("hidden");
        }
        function hideLoginDrawer() {
            if(loginDrawer) loginDrawer.classList.add("translate-x-full");
            if(loginOverlay) loginOverlay.classList.add("hidden");
        }
        
        loginOpenBtn?.addEventListener("click", () => {
            if (auth.currentUser) openProfileDrawer();
            else {
                if(loginDrawer) loginDrawer.classList.remove("translate-x-full");
                if(loginOverlay) loginOverlay.classList.remove("hidden");
                if(window.showLoginView) window.showLoginView();
            }
        });

        loginCloseBtn?.addEventListener("click", hideLoginDrawer);
        loginOverlay?.addEventListener("click", () => { hideLoginDrawer(); closeProfileDrawer(); });
        closeProfileDrawerBtn?.addEventListener("click", closeProfileDrawer);
        document.getElementById('logout-btn')?.addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, (user) => {
            if (user) {
                hideLoginDrawer();
                const userEmailOrPhone = document.getElementById("userEmailOrPhone");
                if (userEmailOrPhone) userEmailOrPhone.textContent = `Welcome! ${user.email || user.phoneNumber}`;
            } else {
                closeProfileDrawer();
            }
        });
    });
    </script>
</head>
<body class="bg-beige-50">

    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex-shrink-0 flex items-center"><img class="h-8 w-8" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ca16fe26-4451-4733-934f-54964f6860ed.png" alt="Grameen Taste logo"><span class="ml-2 text-xl font-bold text-black">Grameen Taste</span></a>
                    <div class="hidden md:ml-8 md:flex md:space-x-8">
                        <a href="index.html#home" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Home</a>
                        <a href="index.html#about" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">About</a>
                        <a href="index.html#products" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Products</a>
                    </div>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <div class="relative"><a href="index.html#cart-items-section" id="cart-btn" class="text-gray-500 hover:text-gray-700 p-2"><i class="fas fa-shopping-cart text-xl"></i><span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-6 flex items-center justify-center">0</span></a></div>
                    <div class="hidden md:block relative"><button id="user-btn" class="text-gray-500 hover:text-gray-700 p-2"><i class="fas fa-user-circle text-xl"></i></button></div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto mt-8 p-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <div class="image-gallery-container">
                <div class="main-image-container relative mb-4 border rounded-lg overflow-hidden">
                    <img id="main-product-image" src="" alt="Main product image" class="w-full h-auto object-cover cursor-crosshair">
                    <div id="magnified-result" class="magnified-result"></div>
                </div>
                <div id="thumbnail-list" class="thumbnail-list flex justify-center space-x-2"></div>
            </div>
            <div class="product-details-content">
                <h1 id="product-name" class="text-3xl font-bold text-gray-800 mb-2"></h1>
                <div class="flex items-center mb-4"><div class="flex text-yellow-400"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></div><a href="#reviews" class="ml-3 text-sm text-gray-600 hover:underline">(125 Reviews)</a></div>
                <p id="product-price" class="text-4xl font-light text-green-700 mb-6"></p>
                <p id="product-description" class="text-gray-600 mb-6 leading-relaxed"></p>
                <div class="mb-6"><h3 class="font-semibold text-lg text-gray-700 mb-2">Highlights:</h3><ul id="product-highlights" class="list-disc list-inside text-gray-600 space-y-1"></ul></div>
                <div class="flex flex-col space-y-4"><div id="product-controls-details" class="flex items-center space-x-4"></div><button id="checkout-btn-details" class="hidden w-full md:w-auto bg-gray-800 text-white px-8 py-3 rounded-md font-semibold hover:bg-black transition">Proceed to Checkout</button></div>
            </div>
        </div>
        <div class="mt-20"><h2 class="text-2xl font-bold text-center text-gray-800 mb-8">You May Also Like</h2><div id="related-products" class="scroll-container flex overflow-x-auto space-x-6 pb-4"></div></div>
    </main>

    <footer class="bg-white py-6 mt-12"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center"><p class="text-gray-600">Â© 2025 Grameen Taste. All rights reserved.</p></div></footer>
    
    <div id="login-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-[998] hidden"></div>
    <div id="login-drawer" class="fixed top-0 right-0 w-96 max-w-full h-full bg-white shadow-lg z-[999] transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex justify-between items-center px-4 py-3 border-b"><h3 id="drawer-title" class="text-xl font-semibold">Login</h3><button id="close-login-drawer" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
        <div class="p-6 pt-4"><div id="recaptcha-container"></div><div id="login-view"></div></div>
    </div>
    <div id="profileDrawer" class="fixed top-0 right-0 w-full max-w-sm h-full bg-white shadow-lg z-[999] transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex justify-between items-center px-4 py-3 border-b"><h2 class="text-xl font-semibold">My Account</h2><button id="closeProfileDrawerBtn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
        <div class="p-6"><p id="userEmailOrPhone" class="text-gray-800 font-medium mb-4">Welcome!</p><button id="logout-btn" class="text-red-600 font-semibold hover:underline">Logout</button></div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const productsData = {
            "1": { name: "Traditional Pickles Collection", price: 450, description: "Rediscover the authentic taste of tradition with our set of 3 artisanal pickles. Handmade with love, using sun-dried ingredients and generations-old recipes, each jar is a trip down memory lane.", images: ["https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/645d4130-76bb-40ef-9b3d-6c162cbe1157.png", "https://images.pexels.com/photos/8969237/pexels-photo-8969237.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1", "https://images.pexels.com/photos/6065666/pexels-photo-6065666.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"], highlights: [ "100% Natural Ingredients", "Authentic Village Recipe", "No Artificial Preservatives", "Includes Mango, Lemon, & Mixed Veg" ], related: ["2", "4", "6", "5"]},
            "2": { name: "Handmade Papad Assortment", price: 350, description: "Experience the crispy, crunchy delight of our handmade papads. A versatile assortment of Urad, Moong, and Rice papads, perfect as an appetizer or accompaniment to any Indian meal.", images: ["https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/e19db699-3471-4fd8-aa6b-5edcc43a9382.png", "https://images.pexels.com/photos/9059129/pexels-photo-9059129.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"], highlights: [ "Made with Premium Lentil Flour", "Sun-dried to Perfection", "No Artificial Flavors", "Pack of 50 Assorted Papads" ], related: ["1", "3", "4", "5"]},
            "3": { name: "Organic Forest Honey", price: 650, description: "Sourced from the pristine forests of the Himalayas, our organic honey is raw, unfiltered, and bursting with natural goodness. Its rich flavor and aroma make it a perfect natural sweetener.", images: ["https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/b60aa9d1-55da-4e14-b1c8-8f346774fb29.png", "https://images.pexels.com/photos/2642631/pexels-photo-2642631.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"], highlights: [ "100% Raw & Unfiltered", "Rich in Natural Antioxidants", "Sustainably Harvested", "Boosts Immunity & Wellness" ], related: ["6", "1", "4", "2"]},
            "4": { name: "Artisan Spice Blends", price: 550, description: "Unlock the secrets of Indian cuisine with our artisan spice blends. This collection features five essential masalas, freshly ground to preserve their potent aroma and flavor.", images: ["https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/cd50ce92-13ae-46ed-91b5-2c4c879d0f83.png", "https://images.pexels.com/photos/3338497/pexels-photo-3338497.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"], highlights: [ "Authentic Regional Flavors", "Freshly Ground Spices", "No Fillers or Additives", "Includes Garam Masala & More" ], related: ["1", "6", "2", "5"]},
            "5": { name: "Festival Sweet Box", price: 750, description: "Celebrate any occasion with our exquisite Festival Sweet Box. A curated selection of traditional Indian mithai, made with pure ghee and the finest ingredients for an unforgettable taste.", images: ["https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/7238fc74-2fee-4e9d-aa46-09cffeb4fda4.png", "https://images.pexels.com/photos/1070850/pexels-photo-1070850.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"], highlights: [ "Made with Pure Ghee", "Assortment of 8 sweets", "Perfect for Gifting", "Freshly Prepared" ], related: ["3", "1", "6", "4"]},
            "6": { name: "Ayurvedic Beverage Mixes", price: 400, description: "Nourish your body and soul with our Ayurvedic beverage mixes. Based on ancient wellness principles, these blends are crafted to promote balance and vitality with every sip.", images: ["https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/1ea54bee-4c03-4dac-951a-10d358857532.png", "https://images.pexels.com/photos/6157037/pexels-photo-6157037.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"], highlights: [ "Promotes Wellness", "Caffeine-Free Options", "Easy to Prepare", "Includes Turmeric Latte & Herbal Chai" ], related: ["3", "4", "1", "2"]}
        };

        let cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const checkoutBtn = document.getElementById('checkout-btn-details');

        function updateCartUI(productId) {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById("cart-count").innerText = totalItems;
            if (checkoutBtn) checkoutBtn.classList.toggle('hidden', cart.length === 0);
            updateProductControls(productId);
        }

        function updateProductControls(productId) {
            const controlsContainer = document.getElementById('product-controls-details');
            if (!controlsContainer) return;
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem && cartItem.quantity > 0) {
                 controlsContainer.innerHTML = `<p class="font-semibold text-lg">Quantity:</p><div class="flex items-center gap-3 border rounded-md p-2"><button data-id="${productId}" class="decrease-qty text-2xl font-bold text-gray-600 hover:text-red-500">â</button><span class="text-xl font-semibold">${cartItem.quantity}</span><button data-id="${productId}" class="increase-qty text-2xl font-bold text-gray-600 hover:text-green-500">+</button></div>`;
            } else {
                controlsContainer.innerHTML = `<button data-id="${productId}" class="add-to-cart w-full md:w-auto bg-green-600 text-white px-8 py-3 rounded-md font-semibold hover:bg-green-700 transition">Add to Cart</button>`;
            }
            controlsContainer.querySelector('.add-to-cart')?.addEventListener('click', handleCartAction);
            controlsContainer.querySelector('.increase-qty')?.addEventListener('click', handleCartAction);
            controlsContainer.querySelector('.decrease-qty')?.addEventListener('click', handleCartAction);
        }

        function handleCartAction(e) {
            const productId = e.target.dataset.id;
            const productData = productsData[productId];
            let cartItem = cart.find(item => item.id === productId);
            if (e.target.classList.contains('add-to-cart')) {
                cart.push({ id: productId, name: productData.name, price: productData.price, quantity: 1 });
            } else if (e.target.classList.contains('increase-qty') && cartItem) {
                cartItem.quantity++;
            } else if (e.target.classList.contains('decrease-qty') && cartItem) {
                cartItem.quantity--;
                if (cartItem.quantity <= 0) cart = cart.filter(item => item.id !== productId);
            }
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartUI(productId);
        }
        
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id') || "1";
        const product = productsData[productId];

        if (product) {
            document.title = `${product.name} - Grameen Taste`;
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-price').textContent = `â¹${product.price}`;
            document.getElementById('product-description').textContent = product.description;
            const mainImage = document.getElementById('main-product-image');
            mainImage.src = product.images[0];
            const thumbnailList = document.getElementById('thumbnail-list');
            thumbnailList.innerHTML = product.images.map((imgSrc, i) => `<img src="${imgSrc}" alt="Thumbnail ${i+1}" class="w-20 h-20 object-cover rounded-md cursor-pointer transition-all duration-200 ${i === 0 ? 'active-thumbnail' : ''}">`).join('');
            document.getElementById('product-highlights').innerHTML = product.highlights.map(h => `<li>${h}</li>`).join('');
            document.getElementById('related-products').innerHTML = product.related.map(id => {
                const p = productsData[id];
                return `<div class="flex-none w-64"><div class="bg-white rounded-lg shadow-md overflow-hidden product-card transition duration-300"><a href="product-details.html?id=${id}"><img src="${p.images[0]}" alt="${p.name}" class="w-full h-48 object-cover"></a><div class="p-4"><h3 class="font-bold text-lg mb-2">${p.name}</h3><div class="flex justify-between items-center"><span class="font-bold text-md">â¹${p.price}</span><a href="product-details.html?id=${id}" class="bg-green-600 text-white px-3 py-1 rounded-md text-sm font-semibold">View</a></div></div></div></div>`;
            }).join('');
            
            updateCartUI(productId);

            thumbnailList.querySelectorAll('img').forEach(thumb => {
                thumb.addEventListener('click', function() {
                    mainImage.src = this.src;
                    thumbnailList.querySelector('img.active-thumbnail')?.classList.remove('active-thumbnail');
                    this.classList.add('active-thumbnail');
                });
            });

            checkoutBtn?.addEventListener('click', () => {
                if (window.auth && window.auth.currentUser) {
                    alert("Redirecting to checkout page!");
                } else {
                    document.getElementById('user-btn')?.click();
                }
            });

            // --- New Magnifier Logic ---
            const mainImageContainer = document.querySelector('.main-image-container');
            const magnifiedResult = document.getElementById('magnified-result');
            
            mainImageContainer.addEventListener('mousemove', (e) => {
                const img = document.getElementById('main-product-image');
                const rect = e.target.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const zoomLevel = 2.5;
                magnifiedResult.style.backgroundImage = `url(${img.src})`;
                magnifiedResult.style.backgroundSize = `${img.width * zoomLevel}px ${img.height * zoomLevel}px`;
                
                const bgX = -(x * zoomLevel - magnifiedResult.offsetWidth / 2);
                const bgY = -(y * zoomLevel - magnifiedResult.offsetHeight / 2);

                magnifiedResult.style.backgroundPosition = `${bgX}px ${bgY}px`;
            });
        } else {
            document.querySelector('main').innerHTML = '<p class="text-center text-red-500 text-xl">Sorry, Product Not Found.</p>';
        }
    });
    </script>
</body>
</html>